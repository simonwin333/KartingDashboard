<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KartDash">
    <title>Karting Dashboard</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- MODAL CONNEXION -->
<div class="modal-overlay" id="authModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <div class="modal-logo">ğŸ</div>
            <h2>Karting Dashboard</h2>
            <p>Connectez-vous pour accÃ©der Ã  vos donnÃ©es</p>
        </div>
        <div class="modal-body">
            <button class="btn-google" id="googleSignInBtn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" alt="G">
                Continuer avec Google
            </button>
            <div class="divider"><span>OU</span></div>
            <div class="form-group">
                <label>E-mail</label>
                <input type="email" id="authEmail" placeholder="votre@email.com">
            </div>
            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="authPassword" placeholder="min. 6 caractÃ¨res">
            </div>
            <button type="button" class="btn-primary" id="authSubmitBtn">Se connecter</button>
            <button type="button" class="btn-secondary" id="authToggleBtn">CrÃ©er un compte</button>
        </div>
    </div>
</div>

<!-- MODAL PROFIL OBLIGATOIRE -->
<div class="modal-overlay" id="profileModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <div class="modal-logo">ğŸï¸</div>
            <h2>Bienvenue !</h2>
            <p>ComplÃ©tez votre profil pilote pour commencer</p>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Nom du pilote *</label>
                <input type="text" id="regPilotName" placeholder="Ex: Simon Dupont">
            </div>
            <div class="form-group">
                <label>Type de kart *</label>
                <input type="text" id="regKartType" placeholder="Ex: CRG Road Rebel">
            </div>
            <div class="form-group">
                <label>Moteur *</label>
                <input type="text" id="regKartEngine" placeholder="Ex: Rotax Max">
            </div>
            <div class="form-group">
                <label>E-mail</label>
                <input type="email" id="regEmail" readonly style="opacity:0.6;">
            </div>
            <div class="cgu-box">
                <label class="cgu-label">
                    <input type="checkbox" id="regCGU">
                    <span>J'accepte les <a href="#" id="cguLink">conditions d'utilisation</a></span>
                </label>
            </div>
            <div id="profileError" class="error-msg" style="display:none;"></div>
            <button type="button" class="btn-primary" id="saveProfileBtn">âœ… Commencer</button>
        </div>
    </div>
</div>

<!-- MODAL CGU -->
<div class="modal-overlay" id="cguModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <h2>ğŸ“„ Conditions d'utilisation</h2>
        </div>
        <div class="modal-body cgu-text">
            <h3>1. Utilisation</h3>
            <p>Karting Dashboard est une application personnelle de suivi de performances en karting, fournie "en l'Ã©tat" pour usage personnel.</p>
            <h3>2. DonnÃ©es personnelles</h3>
            <p>Vos donnÃ©es sont stockÃ©es sur Firebase (Google). Nous ne partageons jamais vos donnÃ©es avec des tiers.</p>
            <h3>3. Authentification</h3>
            <p>Votre e-mail sert uniquement Ã  l'authentification. Vous Ãªtes responsable de la sÃ©curitÃ© de votre compte.</p>
            <h3>4. ResponsabilitÃ©</h3>
            <p>L'application ne peut Ãªtre tenue responsable des dÃ©cisions prises sur la base des donnÃ©es affichÃ©es.</p>
            <h3>5. Suppression</h3>
            <p>Vous pouvez supprimer votre compte et toutes vos donnÃ©es Ã  tout moment dans les RÃ©glages.</p>
            <p class="settings-hint">DerniÃ¨re mise Ã  jour : 17 fÃ©vrier 2026</p>
        </div>
        <div style="padding:20px;text-align:center;">
            <button class="btn-primary" id="closeCguBtn">âœ… J'ai compris</button>
        </div>
    </div>
</div>

<!-- MODAL DÃ‰TAILS SESSION -->
<div class="modal-overlay" id="sessionModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <h2>ğŸ“‹ DÃ©tails</h2>
            <button class="btn-close" id="closeSessionBtn">âœ•</button>
        </div>
        <div class="modal-body" id="sessionDetailsContent"></div>
    </div>
</div>

<!-- MODAL FAQ -->
<div class="modal-overlay" id="faqModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <h2>â“ Questions frÃ©quentes</h2>
            <button class="btn-close" id="closeFaqBtn">âœ•</button>
        </div>
        <div class="modal-body faq-body">
            <div class="faq-item"><div class="faq-q">Comment ajouter une session ?</div><div class="faq-a">Appuyez sur "â• Session", remplissez les champs et validez. La session apparaÃ®t immÃ©diatement dans le dashboard.</div></div>
            <div class="faq-item"><div class="faq-q">Comment est calculÃ© mon meilleur temps ?</div><div class="faq-a">C'est le temps minimum parmi toutes vos sessions sur un circuit. Il s'affiche en vert dans l'analyse des circuits.</div></div>
            <div class="faq-item"><div class="faq-q">Comment ajouter un circuit ?</div><div class="faq-a">Dans le formulaire de session, appuyez sur "â•" Ã  cÃ´tÃ© du champ Circuit, entrez le nom et confirmez.</div></div>
            <div class="faq-item"><div class="faq-q">Puis-je utiliser l'app sur plusieurs appareils ?</div><div class="faq-a">Oui ! Connectez-vous avec le mÃªme compte sur tous vos appareils. Les donnÃ©es se synchronisent automatiquement.</div></div>
            <div class="faq-item"><div class="faq-q">Comment installer l'app sur mon smartphone ?</div><div class="faq-a">RÃ©glages â†’ "ğŸ“² Installer l'app". Sur iOS Safari : Partager â†’ Sur l'Ã©cran d'accueil.</div></div>
            <div class="faq-item"><div class="faq-q">Comment modifier ou supprimer une session ?</div><div class="faq-a">Dans l'Historique, utilisez âœï¸ pour modifier et ğŸ—‘ï¸ pour supprimer.</div></div>
            <div class="faq-item"><div class="faq-q">Pourquoi enregistrer la mÃ©tÃ©o ?</div><div class="faq-a">La mÃ©tÃ©o influence les temps. En la comparant, vous analysez mieux vos vraies performances.</div></div>
            <div class="faq-item"><div class="faq-q">Mes donnÃ©es sont-elles sÃ©curisÃ©es ?</div><div class="faq-a">Oui. StockÃ©es sur Firebase (Google), seul votre compte y a accÃ¨s.</div></div>
            <div class="faq-item"><div class="faq-q">Comment supprimer mon compte ?</div><div class="faq-a">RÃ©glages â†’ "âš ï¸ Supprimer mon compte". Confirmez avec votre nom. Suppression dÃ©finitive.</div></div>
            <div class="faq-item"><div class="faq-q">Comment soutenir le projet ?</div><div class="faq-a">Offrez un cafÃ© sur buymeacoffee.com/kartdashboard â˜• Merci pour votre soutien !</div></div>
        </div>
    </div>
</div>

<!-- POPUP RECORD -->
<div class="record-popup" id="recordPopup" style="display:none;">
    <div class="record-popup-content">
        <div class="record-icon">ğŸ†</div>
        <h2>NOUVEAU RECORD !</h2>
        <p id="recordCircuit" class="record-circuit"></p>
        <p id="recordTime" class="record-time"></p>
        <p class="record-msg">FÃ©licitations ! Vous avez battu votre meilleur temps ! ğŸ‰</p>
        <button class="btn-primary" id="closeRecordBtn">âœ… Super !</button>
    </div>
</div>

<!-- APP PRINCIPALE -->
<div id="appContainer" style="display:none;">
    <header class="app-header">
        <div class="header-left">
            <div class="header-logo">ğŸ</div>
            <div>
                <h1>Karting Dashboard</h1>
                <p id="headerPilotName" class="header-subtitle">-</p>
            </div>
        </div>
        <div class="header-right">
            <a href="https://buymeacoffee.com/kartdashboard" target="_blank" class="coffee-badge" title="Soutenir le projet">â˜•</a>
            <button class="btn-icon nav-btn" data-view="settings">âš™ï¸</button>
        </div>
    </header>

    <nav class="main-nav">
        <button class="nav-btn active" data-view="dashboard">ğŸ <br><span>Dashboard</span></button>
        <button class="nav-btn" data-view="add-session">â•<br><span>Session</span></button>
        <button class="nav-btn" data-view="statistics">ğŸ“Š<br><span>Circuits</span></button>
        <button class="nav-btn" data-view="history">ğŸ“‹<br><span>Historique</span></button>
    </nav>

    <!-- DASHBOARD -->
    <section class="view-section" data-view="dashboard">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸï¸</div>
                <div class="stat-value" id="dashTotalSessions">0</div>
                <div class="stat-label">Nb sessions</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ</div>
                <div class="stat-value" id="dashCircuitsCount">0</div>
                <div class="stat-label">Circuits visitÃ©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-value" id="dashTotalLaps">0</div>
                <div class="stat-label">Nb tours</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">â­</div>
                <div class="stat-value" id="dashFavoriteCircuit">-</div>
                <div class="stat-label">Circuit prÃ©fÃ©rÃ©</div>
                <div class="stat-sublabel" id="dashFavoriteCircuitBest"></div>
            </div>
        </div>
        <div class="section-header"><h2>ğŸ• 10 derniÃ¨res sessions</h2></div>
        <div id="recentSessionsList" class="sessions-list"></div>
    </section>

    <!-- AJOUTER SESSION -->
    <section class="view-section" data-view="add-session" style="display:none;">
        <h2>â• Nouvelle session</h2>
        <form id="sessionForm">
            <div class="form-row">
                <div class="form-group"><label>ğŸ“… Date</label><input type="date" id="date" required></div>
                <div class="form-group"><label>ğŸ• Heure</label><input type="time" id="time"></div>
            </div>
            <div class="form-group">
                <label>ğŸ Circuit</label>
                <div class="circuit-select-row">
                    <select id="circuit" required><option value="">-- SÃ©lectionnez --</option></select>
                    <button type="button" class="btn-add-circuit" id="addCircuitBtn" title="Ajouter un circuit">â•</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>â±ï¸ Meilleur temps (sec)</label><input type="number" id="bestTime" step="0.001" min="0" placeholder="Ex: 65.412" required></div>
                <div class="form-group"><label>ğŸ”¢ Tours</label><input type="number" id="lapsCount" min="0" placeholder="Ex: 20"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>âš™ï¸ Couronne</label><input type="number" id="crownUsed" min="0" placeholder="Ex: 82"></div>
                <div class="form-group"><label>ğŸï¸ Tours moteur</label><input type="number" id="maxLaps" min="0" placeholder="Ex: 1400"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>ğŸŒ¦ï¸ MÃ©tÃ©o</label>
                    <select id="weather"><option value="">--</option><option>â˜€ï¸ Sec</option><option>ğŸŒ¤ï¸ Nuageux</option><option>ğŸŒ§ï¸ Pluie</option><option>ğŸŒ©ï¸ Orage</option></select>
                </div>
                <div class="form-group"><label>ğŸŒ¡ï¸ TempÃ©rature (Â°C)</label><input type="number" id="temperature" min="-20" max="50" placeholder="Ex: 18"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>ğŸ› Pneus</label>
                    <select id="tireType"><option value="">--</option><option>Soft</option><option>Medium</option><option>Hard</option><option>Pluie</option></select>
                </div>
                <div class="form-group"><label>âš¡ Pression (bar)</label><input type="number" id="tirePressure" step="0.001" min="0" max="5" placeholder="Ex: 0.851"></div>
            </div>
            <div class="form-group"><label>ğŸ“ Notes</label><textarea id="notes" rows="3" placeholder="Observations, rÃ©glages..."></textarea></div>
            <div class="form-actions">
                <button type="submit" class="btn-primary" id="submitBtn">ğŸ“Š Enregistrer la session</button>
                <button type="button" class="btn-secondary" id="cancelEditBtn" style="display:none;">âœ• Annuler</button>
            </div>
        </form>
    </section>

    <!-- CIRCUITS -->
    <section class="view-section" data-view="statistics" style="display:none;">
        <div class="section-header">
            <h2>ğŸ“Š Analyse par circuit</h2>
            <select id="circuitFilter"><option value="all">Tous les circuits</option></select>
        </div>
        <div id="circuitsAnalysis"></div>
    </section>

    <!-- HISTORIQUE -->
    <section class="view-section" data-view="history" style="display:none;">
        <h2>ğŸ“‹ Historique complet</h2>
        <div id="sessionsList" class="sessions-list"></div>
    </section>

    <!-- RÃ‰GLAGES -->
    <section class="view-section" data-view="settings" style="display:none;">
        <h2>âš™ï¸ RÃ©glages</h2>
        <div class="settings-section">
            <h3>ğŸ‘¤ Profil du pilote</h3>
            <div class="profil-field-row"><span class="profil-field-lbl">Nom</span><input type="text" id="pilotName" class="settings-input profil-input-compact" placeholder="Votre nom"></div>
            <div class="profil-field-row"><span class="profil-field-lbl">Kart</span><input type="text" id="kartType" class="settings-input profil-input-compact" placeholder="Ex: CRG Road Rebel"></div>
            <div class="profil-field-row"><span class="profil-field-lbl">Moteur</span><input type="text" id="kartEngine" class="settings-input profil-input-compact" placeholder="Ex: Rotax Max"></div>
            <button class="btn-settings" id="saveProfileSettingsBtn">ğŸ’¾ Sauvegarder le profil</button>
        </div>
        <div class="settings-section">
            <h3>â¤ï¸ Soutenir le projet</h3>
            <a href="https://buymeacoffee.com/kartdashboard" target="_blank" rel="noopener">
                <button class="btn-settings btn-donate">â˜• Offrir un cafÃ© au crÃ©ateur</button>
            </a>
            <p class="settings-hint">Votre soutien aide Ã  amÃ©liorer l'app !</p>
        </div>
        <div class="settings-section">
            <h3>ğŸ“² Installation smartphone</h3>
            <button class="btn-settings" id="installBtn" style="display:none;">ğŸ“² Installer sur l'Ã©cran d'accueil</button>
            <div id="pwaInstructions" class="settings-hint"></div>
        </div>
        <div class="settings-section">
            <h3>ğŸ¨ Apparence</h3>
            <select class="settings-select" id="themeMode">
                <option value="dark">ğŸŒ™ Sombre</option>
                <option value="light">â˜€ï¸ Clair</option>
            </select>
        </div>
        <div class="settings-section">
            <h3>â„¹ï¸ Aide</h3>
            <button class="btn-settings" id="faqBtn">â“ FAQ - Questions frÃ©quentes</button>
        </div>
        <div class="settings-section">
            <h3>ğŸ” Compte</h3>
            <p id="settingsUserEmail" class="settings-hint"></p>
            <button class="btn-settings" id="logoutBtn">ğŸšª Se dÃ©connecter</button>
        </div>
        <div class="settings-section">
            <h3>ğŸ’¾ DonnÃ©es</h3>
            <button class="btn-settings btn-danger" id="clearDataBtn">âš ï¸ Supprimer dÃ©finitivement mon compte</button>
            <p class="settings-hint">âš ï¸ Action irrÃ©versible</p>
        </div>
        <div class="settings-section">
            <p class="settings-hint" style="text-align:center;">Karting Dashboard v4.0 â¤ï¸</p>
        </div>
    </section>
</div>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="app.js"></script>
</body>
</html>
